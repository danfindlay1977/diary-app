{"ast":null,"code":"var _jsxFileName = \"/Users/danielfindlay/Desktop/full-projects/diary/diary-app/src/pages/Stories.js\",\n    _s = $RefreshSig$();\n\nimport Controls from \"../components/UI/Controls\";\nimport StoryItems from \"../components/UI/StoryItems\";\nimport { useEffect, useState, useRef } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { useNavigate, useLocation } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet FIRST_RENDER = true;\nconst ClASSES = [\"stories-entry1\", \"stories-entry-large\", \"stories-entry-small1\", \"stories-entry-small2\", \"stories-entry2\"];\n\nconst Stories = () => {\n  _s();\n\n  const navigator = useNavigate();\n  const location = useLocation();\n  const params = location.search ? location.search : \"\";\n  let timerId;\n  const token = useSelector(state => state.auth.token);\n  const [wordLimit, setWordLimit] = useState(0);\n  const [storiesState, setStoriesState] = useState([]);\n  const [urlFilter, setUrlFilter] = useState(\"\");\n  const urlFilterRef = useRef(urlFilter);\n  urlFilterRef.current = urlFilter;\n  const [sorting, setSorting] = useState(\"\");\n  const [sortOrder, setSortOrder] = useState(\"Ascending\");\n  const [page, setPage] = useState(1);\n  useEffect(() => {\n    const apiCall = async () => {\n      try {\n        let query;\n\n        if (params && !urlFilterRef.current) {\n          query = params;\n        } else {\n          query = urlFilterRef.current;\n        } // check if sorting is needed\n\n\n        if (sorting) {\n          if (query.length === 0) {\n            query = `?sort=${sorting}`;\n          } else {\n            query = query + \"&sort=\" + sorting;\n          }\n        } // check if pagenation is needed\n\n\n        if (page) {\n          if (query.length === 0) {\n            query = `?page=${page}`;\n          } else {\n            query = query + \"&page=\" + page;\n          }\n        }\n\n        const response = await fetch(`http://localhost:8080/api/entry/fetch${query}`, {\n          headers: {\n            \"Authorization\": `bearer ${token}`\n          }\n        });\n        const {\n          entries\n        } = await response.json();\n        setStoriesState(entries);\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    if (FIRST_RENDER) {\n      FIRST_RENDER = false;\n      apiCall();\n    } else {\n      const timer = setTimeout(() => {\n        buildFilter(wordLimit);\n        console.log(urlFilterRef.current + \" outside of api call\");\n        apiCall();\n      }, 2000);\n      return () => {\n        clearTimeout(timer);\n      };\n    }\n  }, [wordLimit, sorting, page]);\n\n  const SortChangeHandler = e => {\n    console.log(e.target.value);\n    setSortOrder(e.target.value);\n\n    if (e.target.value === \"Ascending\") {\n      setSorting(\"updatedAt\");\n    } else if (e.target.value === \"Descending\") {\n      setSorting(\"-updatedAt\");\n    }\n  };\n\n  const rangeOnChangeHandler = e => {\n    setWordLimit(e.target.value);\n  };\n\n  const testFilter = () => {\n    console.log(\"in test filtr \" + urlFilter);\n  };\n\n  const buildFilter = value => {\n    console.log(\" value is \" + value);\n    const filter = `?wordCount[gte]=${value}`;\n    setUrlFilter(filter);\n    navigator(filter);\n    console.log(` in build filter ${urlFilter}`);\n  };\n\n  const storyList = storiesState.map((story, index) => {\n    return /*#__PURE__*/_jsxDEV(StoryItems, {\n      classes: ClASSES[index],\n      title: story.title,\n      topic: story.topic,\n      entry: story.entry\n    }, story._id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 15\n    }, this);\n  });\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    className: \"stories-grid\",\n    children: [/*#__PURE__*/_jsxDEV(Controls, {\n      filterOrder: sortOrder,\n      wordLimit: wordLimit,\n      onSortChangeHandler: SortChangeHandler,\n      onChangeHandler: rangeOnChangeHandler\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 10\n    }, this), !storyList ? /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"There are no entries by this user\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 24\n    }, this) : storyList, /*#__PURE__*/_jsxDEV(Pagenation, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 10\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 110,\n    columnNumber: 8\n  }, this);\n};\n\n_s(Stories, \"XzZhiXvXngOf2mrdnmPu6P1Psgw=\", false, function () {\n  return [useNavigate, useLocation, useSelector];\n});\n\n_c = Stories;\nexport default Stories;\n\nvar _c;\n\n$RefreshReg$(_c, \"Stories\");","map":{"version":3,"sources":["/Users/danielfindlay/Desktop/full-projects/diary/diary-app/src/pages/Stories.js"],"names":["Controls","StoryItems","useEffect","useState","useRef","useSelector","useNavigate","useLocation","FIRST_RENDER","ClASSES","Stories","navigator","location","params","search","timerId","token","state","auth","wordLimit","setWordLimit","storiesState","setStoriesState","urlFilter","setUrlFilter","urlFilterRef","current","sorting","setSorting","sortOrder","setSortOrder","page","setPage","apiCall","query","length","response","fetch","headers","entries","json","e","console","log","timer","setTimeout","buildFilter","clearTimeout","SortChangeHandler","target","value","rangeOnChangeHandler","testFilter","filter","storyList","map","story","index","title","topic","entry","_id"],"mappings":"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","sourcesContent":["import Controls from \"../components/UI/Controls\"\nimport StoryItems from \"../components/UI/StoryItems\"\nimport {useEffect , useState, useRef} from \"react\"\nimport {useSelector} from \"react-redux\"\nimport {useNavigate, useLocation} from \"react-router-dom\"\nlet FIRST_RENDER = true\nconst ClASSES = [\"stories-entry1\", \"stories-entry-large\", \"stories-entry-small1\", \"stories-entry-small2\", \"stories-entry2\" ]\nconst Stories = () => {\n    const navigator = useNavigate()\n    const location = useLocation()\n    const params = location.search ? location.search : \"\"\n    let timerId;\n    const token = useSelector(state => state.auth.token)\n    const [wordLimit, setWordLimit] = useState(0)\n    const [storiesState, setStoriesState] = useState([])\n    const [urlFilter, setUrlFilter] = useState(\"\")\n    const urlFilterRef = useRef(urlFilter)\n    urlFilterRef.current = urlFilter\n    const [sorting, setSorting] = useState(\"\")\n    const [sortOrder, setSortOrder] = useState(\"Ascending\")\n    const [page, setPage] = useState(1)\n\n    useEffect(() => {\n        const apiCall = async () => {\n            try{\n                let query;\n                if (params && !urlFilterRef.current) {\n                    query = params;\n                  } else {\n                    query = urlFilterRef.current;\n                  }\n                  // check if sorting is needed\n                  if(sorting) {\n                      if(query.length === 0) {\n                        query = `?sort=${sorting}`\n                      }\n                      else{\n                          query = query + \"&sort=\" + sorting\n                      }\n                  }\n                  // check if pagenation is needed\n                  if(page) {\n                    if(query.length === 0) {\n                        query = `?page=${page}`\n                    }\n                    else{\n                        query = query + \"&page=\" + page\n                    }\n                  }\n                const response = await fetch(`http://localhost:8080/api/entry/fetch${query}`, {\n                    headers:{\n                        \"Authorization\": `bearer ${token}`\n                    }\n                })\n                const {entries} = await response.json()\n                setStoriesState(entries)\n            }\n            catch(e) {\n                console.log(e)\n            }\n        }\n            if(FIRST_RENDER) {\n                FIRST_RENDER = false\n                apiCall()\n            }\n            else{\n                const timer =  setTimeout(() => {\n                    buildFilter(wordLimit)\n                    console.log(urlFilterRef.current + \" outside of api call\")\n                    apiCall()\n                }, 2000)\n               \n       \n           return () => {\n               clearTimeout(timer)\n           }\n            }\n      \n    }, [wordLimit, sorting, page])\n  \n    const SortChangeHandler = (e) => {\n        console.log(e.target.value)\n        setSortOrder(e.target.value)\n        if (e.target.value === \"Ascending\") {\n            setSorting(\"updatedAt\");\n          } else if (e.target.value === \"Descending\") {\n            setSorting(\"-updatedAt\");\n          }\n    }\n    const rangeOnChangeHandler =  (e) => {\n        setWordLimit(e.target.value)\n    \n    }\n    const testFilter = () => {\n        console.log(\"in test filtr \" + urlFilter)\n    }\n    const buildFilter = (value) => {\n        console.log(\" value is \" + value)\n        const filter = `?wordCount[gte]=${value}`\n        setUrlFilter(filter)\n        navigator(filter)\n        console.log(` in build filter ${urlFilter}`)\n    }\n\n  const storyList =  storiesState.map((story, index) => {\n       return <StoryItems classes={ClASSES[index]} title={story.title} topic={story.topic} entry={story.entry} key={story._id}/>\n    })\n\n    return (\n       <section className=\"stories-grid\">\n         <Controls filterOrder={sortOrder} wordLimit={wordLimit} onSortChangeHandler={SortChangeHandler} onChangeHandler={rangeOnChangeHandler}/>\n         {!storyList ? <p>There are no entries by this user</p> : storyList}\n         <Pagenation/>\n       </section>\n    )\n}\n\nexport default Stories\n"]},"metadata":{},"sourceType":"module"}