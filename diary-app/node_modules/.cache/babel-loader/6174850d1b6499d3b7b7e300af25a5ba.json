{"ast":null,"code":"var _jsxFileName = \"/Users/danielfindlay/Desktop/full-projects/diary/diary-app/src/pages/Stories.js\",\n    _s = $RefreshSig$();\n\nimport Controls from \"../components/UI/Controls\";\nimport StoryItems from \"../components/UI/StoryItems\";\nimport { useEffect, useState, useRef } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { useNavigate, useLocation } from \"react-router-dom\";\nimport Pagenation from \"../components/UI/Pagenation\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet FIRST_RENDER = true;\nconst ClASSES = [\"stories-entry1\", \"stories-entry-large\", \"stories-entry-small1\", \"stories-entry-small2\", \"stories-entry2\"];\n\nconst Stories = ({\n  match\n}) => {\n  _s();\n\n  const pageNumber = match.params.pageNumber || 1;\n  const navigator = useNavigate();\n  const location = useLocation();\n  const params = location.search ? location.search : \"\";\n  const token = useSelector(state => state.auth.token);\n  const [wordLimit, setWordLimit] = useState(0);\n  const [storiesState, setStoriesState] = useState([]);\n  const [urlFilter, setUrlFilter] = useState(\"\");\n  const urlFilterRef = useRef(urlFilter);\n  urlFilterRef.current = urlFilter;\n  const [sorting, setSorting] = useState(\"\");\n  const [sortOrder, setSortOrder] = useState(\"Ascending\");\n  const [page, setPage] = useState(pageNumber);\n  const [pages, setPages] = useState(null);\n  useEffect(() => {\n    const apiCall = async () => {\n      try {\n        let query;\n\n        if (params && !urlFilterRef.current) {\n          query = params;\n        } else {\n          query = urlFilterRef.current;\n        } // check if sorting is needed\n\n\n        if (sorting) {\n          if (query.length === 0) {\n            query = `?sort=${sorting}`;\n          } else {\n            query = query + \"&sort=\" + sorting;\n          }\n        } // check if pagenation is needed\n\n\n        if (page) {\n          if (query.length === 0) {\n            query = `?page=${page}`;\n          } else {\n            query = query + \"&page=\" + page;\n          }\n        }\n\n        const response = await fetch(`http://localhost:8080/api/entry/fetch${query}`, {\n          headers: {\n            \"Authorization\": `bearer ${token}`\n          }\n        });\n        const {\n          entries,\n          totalPages: pages\n        } = await response.json();\n        setStoriesState(entries);\n        setPages(totalPages);\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    if (FIRST_RENDER) {\n      FIRST_RENDER = false;\n      apiCall();\n    } else {\n      const timer = setTimeout(() => {\n        buildFilter(wordLimit);\n        apiCall();\n      }, 2000);\n      return () => {\n        clearTimeout(timer);\n      };\n    }\n  }, [wordLimit, sorting, page]);\n\n  const SortChangeHandler = e => {\n    setSortOrder(e.target.value);\n\n    if (e.target.value === \"Ascending\") {\n      setSorting(\"updatedAt\");\n    } else if (e.target.value === \"Descending\") {\n      setSorting(\"-updatedAt\");\n    }\n  };\n\n  const rangeOnChangeHandler = e => {\n    setWordLimit(e.target.value);\n  };\n\n  const buildFilter = value => {\n    const filter = `?wordCount[gte]=${value}`;\n    setUrlFilter(filter);\n    navigator(filter);\n  };\n\n  const storyList = storiesState.map((story, index) => {\n    return /*#__PURE__*/_jsxDEV(StoryItems, {\n      classes: ClASSES[index],\n      title: story.title,\n      topic: story.topic,\n      entry: story.entry\n    }, story._id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 15\n    }, this);\n  });\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    className: \"stories-grid\",\n    children: [/*#__PURE__*/_jsxDEV(Controls, {\n      filterOrder: sortOrder,\n      wordLimit: wordLimit,\n      onSortChangeHandler: SortChangeHandler,\n      onChangeHandler: rangeOnChangeHandler\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 10\n    }, this), !storyList ? /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"There are no entries by this user\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 24\n    }, this) : storyList, /*#__PURE__*/_jsxDEV(Pagenation, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 10\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 106,\n    columnNumber: 8\n  }, this);\n};\n\n_s(Stories, \"ecdqnjlh0Ci6qsgUkODlZZxMqGA=\", false, function () {\n  return [useNavigate, useLocation, useSelector];\n});\n\n_c = Stories;\nexport default Stories;\n\nvar _c;\n\n$RefreshReg$(_c, \"Stories\");","map":{"version":3,"sources":["/Users/danielfindlay/Desktop/full-projects/diary/diary-app/src/pages/Stories.js"],"names":["Controls","StoryItems","useEffect","useState","useRef","useSelector","useNavigate","useLocation","Pagenation","FIRST_RENDER","ClASSES","Stories","match","pageNumber","params","navigator","location","search","token","state","auth","wordLimit","setWordLimit","storiesState","setStoriesState","urlFilter","setUrlFilter","urlFilterRef","current","sorting","setSorting","sortOrder","setSortOrder","page","setPage","pages","setPages","apiCall","query","length","response","fetch","headers","entries","totalPages","json","e","console","log","timer","setTimeout","buildFilter","clearTimeout","SortChangeHandler","target","value","rangeOnChangeHandler","filter","storyList","map","story","index","title","topic","entry","_id"],"mappings":"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","sourcesContent":["import Controls from \"../components/UI/Controls\"\nimport StoryItems from \"../components/UI/StoryItems\"\nimport {useEffect , useState, useRef} from \"react\"\nimport {useSelector} from \"react-redux\"\nimport {useNavigate, useLocation} from \"react-router-dom\"\nimport Pagenation from \"../components/UI/Pagenation\"\nlet FIRST_RENDER = true\nconst ClASSES = [\"stories-entry1\", \"stories-entry-large\", \"stories-entry-small1\", \"stories-entry-small2\", \"stories-entry2\" ]\nconst Stories = ({match}) => {\n    const pageNumber = match.params.pageNumber || 1\n    const navigator = useNavigate()\n    const location = useLocation()\n    const params = location.search ? location.search : \"\"\n    const token = useSelector(state => state.auth.token)\n    const [wordLimit, setWordLimit] = useState(0)\n    const [storiesState, setStoriesState] = useState([])\n    const [urlFilter, setUrlFilter] = useState(\"\")\n    const urlFilterRef = useRef(urlFilter)\n    urlFilterRef.current = urlFilter\n    const [sorting, setSorting] = useState(\"\")\n    const [sortOrder, setSortOrder] = useState(\"Ascending\")\n    const [page, setPage] = useState(pageNumber)\n    const [pages, setPages] = useState(null)\n\n    useEffect(() => {\n        const apiCall = async () => {\n            try{\n                let query;\n                if (params && !urlFilterRef.current) {\n                    query = params;\n                  } else {\n                    query = urlFilterRef.current;\n                  }\n                  // check if sorting is needed\n                  if(sorting) {\n                      if(query.length === 0) {\n                        query = `?sort=${sorting}`\n                      }\n                      else{\n                          query = query + \"&sort=\" + sorting\n                      }\n                  }\n                  // check if pagenation is needed\n                  if(page) {\n                    if(query.length === 0) {\n                        query = `?page=${page}`\n                    }\n                    else{\n                        query = query + \"&page=\" + page\n                    }\n                  }\n                const response = await fetch(`http://localhost:8080/api/entry/fetch${query}`, {\n                    headers:{\n                        \"Authorization\": `bearer ${token}`\n                    }\n                })\n                const {entries, totalPages:pages} = await response.json()\n                setStoriesState(entries)\n                setPages(totalPages)\n            }\n            catch(e) {\n                console.log(e)\n            }\n        }\n            if(FIRST_RENDER) {\n                FIRST_RENDER = false\n                apiCall()\n            }\n            else{\n                const timer =  setTimeout(() => {\n                    buildFilter(wordLimit)\n                    apiCall()\n                }, 2000)\n               \n       \n           return () => {\n               clearTimeout(timer)\n           }\n            }\n      \n    }, [wordLimit, sorting, page])\n  \n    const SortChangeHandler = (e) => {\n        setSortOrder(e.target.value)\n        if (e.target.value === \"Ascending\") {\n            setSorting(\"updatedAt\");\n          } else if (e.target.value === \"Descending\") {\n            setSorting(\"-updatedAt\");\n          }\n    }\n    const rangeOnChangeHandler =  (e) => {\n        setWordLimit(e.target.value)\n    \n    }\n    const buildFilter = (value) => {\n        const filter = `?wordCount[gte]=${value}`\n        setUrlFilter(filter)\n        navigator(filter)\n    }\n\n  const storyList =  storiesState.map((story, index) => {\n       return <StoryItems classes={ClASSES[index]} title={story.title} topic={story.topic} entry={story.entry} key={story._id}/>\n    })\n\n    return (\n       <section className=\"stories-grid\">\n         <Controls filterOrder={sortOrder} wordLimit={wordLimit} onSortChangeHandler={SortChangeHandler} onChangeHandler={rangeOnChangeHandler}/>\n         {!storyList ? <p>There are no entries by this user</p> : storyList}\n         <Pagenation/>\n       </section>\n    )\n}\n\nexport default Stories\n"]},"metadata":{},"sourceType":"module"}