{"ast":null,"code":"var _jsxFileName = \"/Users/danielfindlay/Desktop/full-projects/diary/diary-app/src/pages/Stories.js\",\n    _s = $RefreshSig$();\n\nimport Controls from \"../components/UI/Controls\";\nimport StoryItems from \"../components/UI/StoryItems\";\nimport { useEffect, useState, useRef } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { useNavigate, useLocation } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet FIRST_RENDER = true;\nconst ClASSES = [\"stories-entry1\", \"stories-entry-large\", \"stories-entry-small1\", \"stories-entry-small2\", \"stories-entry2\"];\n\nconst Stories = () => {\n  _s();\n\n  const navigator = useNavigate();\n  const location = useLocation();\n  const params = location.search ? location.search : \"\";\n  let timerId;\n  const token = useSelector(state => state.auth.token);\n  const [wordLimit, setWordLimit] = useState(0);\n  const [storiesState, setStoriesState] = useState([]);\n  const [urlFilter, setUrlFilter] = useState(\"\");\n  const urlFilterRef = useRef(urlFilter);\n  urlFilterRef.current = urlFilter;\n  const [sorting, setSorting] = useState(\"\");\n  const [sortOrder, setSortOrder] = useState(\"Ascending\");\n  useEffect(() => {\n    const apiCall = async () => {\n      try {\n        let query;\n        console.log(\"in api call \" + urlFilter);\n\n        if (params && !urlFilter) {\n          query = params;\n        } else {\n          query = urlFilter;\n        }\n\n        if (sorting) {\n          if (query.length === 0) {\n            query = `?sort=${sorting}`;\n          } else {\n            query = query + \"&sort=\" + sorting;\n          }\n        }\n\n        const response = await fetch(`http://localhost:8080/api/entry/fetch${query}`, {\n          headers: {\n            \"Authorization\": `bearer ${token}`\n          }\n        });\n        const {\n          entries\n        } = await response.json();\n        setStoriesState(entries);\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    if (FIRST_RENDER) {\n      FIRST_RENDER = false;\n      apiCall();\n    } else {\n      setUrlFilter(20);\n      console.log(`in useffect ${urlFilter}`);\n      const timer = setTimeout(() => {\n        buildFilter(wordLimit);\n        console.log(urlFilter + \" outside of api call\");\n        apiCall();\n      }, 2000);\n      return () => {\n        clearTimeout(timer);\n      };\n    }\n  }, [wordLimit, sorting]);\n\n  const SortChangeHandler = e => {\n    console.log(e.target.value);\n    setSortOrder(e.target.value);\n\n    if (e.target.value === \"Ascending\") {\n      setSorting(\"updatedAt\");\n    } else if (e.target.value === \"Descending\") {\n      setSorting(\"-updatedAt\");\n    }\n  };\n\n  const rangeOnChangeHandler = e => {\n    setWordLimit(e.target.value);\n  };\n\n  const testFilter = () => {\n    console.log(\"in test filtr \" + urlFilter);\n  };\n\n  const buildFilter = value => {\n    console.log(\" value is \" + value);\n    const filter = `?wordCount[gte]=${value}`;\n    setUrlFilter(filter);\n    navigator(filter);\n    console.log(` in build filter ${urlFilter}`);\n  };\n\n  const storyList = storiesState.map((story, index) => {\n    return /*#__PURE__*/_jsxDEV(StoryItems, {\n      classes: ClASSES[index],\n      title: story.title,\n      topic: story.topic,\n      entry: story.entry\n    }, story._id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 15\n    }, this);\n  });\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    className: \"stories-grid\",\n    children: [/*#__PURE__*/_jsxDEV(Controls, {\n      filterOrder: sortOrder,\n      wordLimit: wordLimit,\n      onSortChangeHandler: SortChangeHandler,\n      onChangeHandler: rangeOnChangeHandler\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 10\n    }, this), !storyList ? /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"There are no entries by this user\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 24\n    }, this) : storyList, /*#__PURE__*/_jsxDEV(\"section\", {\n      className: \"stories-pageCount\",\n      children: /*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Page count here\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 49\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 10\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 102,\n    columnNumber: 8\n  }, this);\n};\n\n_s(Stories, \"JdDU/w+WJxqld5Yp5YAznQLrlcM=\", false, function () {\n  return [useNavigate, useLocation, useSelector];\n});\n\n_c = Stories;\nexport default Stories;\n\nvar _c;\n\n$RefreshReg$(_c, \"Stories\");","map":{"version":3,"sources":["/Users/danielfindlay/Desktop/full-projects/diary/diary-app/src/pages/Stories.js"],"names":["Controls","StoryItems","useEffect","useState","useRef","useSelector","useNavigate","useLocation","FIRST_RENDER","ClASSES","Stories","navigator","location","params","search","timerId","token","state","auth","wordLimit","setWordLimit","storiesState","setStoriesState","urlFilter","setUrlFilter","urlFilterRef","current","sorting","setSorting","sortOrder","setSortOrder","apiCall","query","console","log","length","response","fetch","headers","entries","json","e","timer","setTimeout","buildFilter","clearTimeout","SortChangeHandler","target","value","rangeOnChangeHandler","testFilter","filter","storyList","map","story","index","title","topic","entry","_id"],"mappings":"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","sourcesContent":["import Controls from \"../components/UI/Controls\"\nimport StoryItems from \"../components/UI/StoryItems\"\nimport {useEffect , useState, useRef} from \"react\"\nimport {useSelector} from \"react-redux\"\nimport {useNavigate, useLocation} from \"react-router-dom\"\nlet FIRST_RENDER = true\nconst ClASSES = [\"stories-entry1\", \"stories-entry-large\", \"stories-entry-small1\", \"stories-entry-small2\", \"stories-entry2\" ]\nconst Stories = () => {\n    const navigator = useNavigate()\n    const location = useLocation()\n    const params = location.search ? location.search : \"\"\n    let timerId;\n    const token = useSelector(state => state.auth.token)\n    const [wordLimit, setWordLimit] = useState(0)\n    const [storiesState, setStoriesState] = useState([])\n    const [urlFilter, setUrlFilter] = useState(\"\")\n    const urlFilterRef = useRef(urlFilter)\n    urlFilterRef.current = urlFilter\n    const [sorting, setSorting] = useState(\"\")\n    const [sortOrder, setSortOrder] = useState(\"Ascending\")\n\n    useEffect(() => {\n        const apiCall = async () => {\n            try{\n                let query;\n                console.log(\"in api call \" + urlFilter)\n                if (params && !urlFilter) {\n                    query = params;\n                  } else {\n                    query = urlFilter;\n                  }\n                  if(sorting) {\n                      if(query.length === 0) {\n                        query = `?sort=${sorting}`\n                      }\n                      else{\n                          query = query + \"&sort=\" + sorting\n                      }\n                  }\n                const response = await fetch(`http://localhost:8080/api/entry/fetch${query}`, {\n                    headers:{\n                        \"Authorization\": `bearer ${token}`\n                    }\n                })\n                const {entries} = await response.json()\n                setStoriesState(entries)\n            }\n            catch(e) {\n                console.log(e)\n            }\n        }\n            if(FIRST_RENDER) {\n                FIRST_RENDER = false\n                apiCall()\n            }\n            else{\n                setUrlFilter(20)\n                console.log(`in useffect ${urlFilter}`)\n                const timer =  setTimeout(() => {\n                    buildFilter(wordLimit)\n                    console.log(urlFilter + \" outside of api call\")\n                    apiCall()\n                }, 2000)\n               \n       \n           return () => {\n               clearTimeout(timer)\n           }\n            }\n      \n    }, [wordLimit, sorting])\n  \n    const SortChangeHandler = (e) => {\n        console.log(e.target.value)\n        setSortOrder(e.target.value)\n        if (e.target.value === \"Ascending\") {\n            setSorting(\"updatedAt\");\n          } else if (e.target.value === \"Descending\") {\n            setSorting(\"-updatedAt\");\n          }\n    }\n    const rangeOnChangeHandler =  (e) => {\n        setWordLimit(e.target.value)\n    \n    }\n    const testFilter = () => {\n        console.log(\"in test filtr \" + urlFilter)\n    }\n    const buildFilter = (value) => {\n        console.log(\" value is \" + value)\n        const filter = `?wordCount[gte]=${value}`\n        setUrlFilter(filter)\n        navigator(filter)\n        console.log(` in build filter ${urlFilter}`)\n    }\n\n  const storyList =  storiesState.map((story, index) => {\n       return <StoryItems classes={ClASSES[index]} title={story.title} topic={story.topic} entry={story.entry} key={story._id}/>\n    })\n\n    return (\n       <section className=\"stories-grid\">\n         <Controls filterOrder={sortOrder} wordLimit={wordLimit} onSortChangeHandler={SortChangeHandler} onChangeHandler={rangeOnChangeHandler}/>\n         {!storyList ? <p>There are no entries by this user</p> : storyList}\n         <section className=\"stories-pageCount\"><h1>Page count here</h1></section>\n       </section>\n    )\n}\n\nexport default Stories\n"]},"metadata":{},"sourceType":"module"}